<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    
    <title>Ice Dodo - UnOfficial Site</title>
    <link rel="icon" href="/assets/icons/icon.png">
    <meta name="description" content="Play hundreds of 3D Ice dodo levels. Do not fall off or touch spikes.">
    
    <script type="module" crossorigin src="/assets/index.js"></script>
    <link rel="stylesheet" href="/assets/index.css">
    <style>
        .button {
            margin-bottom:5px;
            margin-top:5px;
            border: 4px solid #bbbbbb;
            border-radius: 10px;
            background-color: transparent;
            color:white;
            cursor: pointer;
        }
        .button:hover {
            background: #8A0468;
        }
        input[type=text] {
            width:2vw;
        }
        p {
            margin: 2px;
        }
    </style>
  </head>
  <body>
    <div id="appContainer">
      <div id="app"></div>
    </div>
    <div id="preroll"></div>
    <div id="ModMenu">
        <div id="ModMenuContent" style="opacity: 75%;position:absolute;top:0;right:5vw;width:17vw;border:rgb(59, 59, 59) 1px solid;background-color: rgb(39, 39, 39);border-radius: 0 0 5px 5px;-index:-1">
            <button id="togglemenu" class="modbutton">ModMenu (click)</button>
            <div class="modmenuOption">
                <botton class="button" onclick="window.location.href='../'">Back To Config</botton>
                <br>
                <input id="spin" type="checkbox">
                <label>Turn Off Spin</label>
                <br>
                <button id="togglecheats" class="modbutton">Cheats</button>
                <div id="cheats">
                    <input id="godmode" type="checkbox">
                    <label>Godmode</label>
                    <br>
                    <input id="gravityoverwrite" type="checkbox">
                    <label>Overwrite Gravity?</label>
                    <br>
                    <!-- <input id="gravity" type="number" > -->
                    <div id="gravitytoggle">
                        <input type="range" min="-18" max="0" id="gravity" step="1">
                        <p style="display:block;margin:0;" id="gravityindicator">0</p> 
                    </div>

                    <input id="speedoverwrite" type="checkbox">
                    <label>Overwrite speed?</label>
                    <br>
                    <!-- <input id="speed" type="number" > -->
                    <div id="speedtoggle">
                        <input type="range" min="0" max="1" id="speed" step=".02">
                        <p style="display:block;margin:0;" id="speedindicator">0.28</p>
                    </div>
                    <botton class="button" onclick="window.tsTriggers.onWin()">Instant Win</botton>
                </div>
                <button id="toggledodocontrols" class="modbutton">Dodo Cinematics</button>
                <!-- <button id="testbutton" class="modbutton">Dodo rotation</button> -->
                <div id="dodocontrols">
                    <input id="freecam" type="checkbox">
                    <label>FreeCam</label>
                    <br>
                    <input id="freeze" type="checkbox" >
                    <label >Freeze Dodo</label>
                    <br >
                    <input id="follow" type="checkbox" >
                    <label >Follow Player</label>
                    <br >
                    <p style="margin: 0;">Movement</p>
                    <div class="container">
                        <div class="home"><button id="home" class="dodocontrolButton">Home</button></div>
                        <div class="up"><button id="up" class="dodocontrolButton">Up</button></div>
                        <div class="left"><button id="left" class="dodocontrolButton">Left</button></div>
                        <div class="right"><button id="right" class="dodocontrolButton">Right</button></div>
                        <div class="down"><button id="down" class="dodocontrolButton">Down</button></div>
                        <div class="foreward"><button id="foreward" class="dodocontrolButton">forewards</button></div>
                        <div class="backward"><button id="backward" class="dodocontrolButton">backwards</button></div>
                    </div>
                    <p style="margin: 0;">Rotation</p>
                    <div class="container">
                        <div class="home"><button id="Chome" class="dodocontrolButton">Home</button></div>
                        <div class="up"><button id="Cup" class="dodocontrolButton">Up</button></div>
                        <div class="left"><button id="Cleft" class="dodocontrolButton">Left</button></div>
                        <div class="right"><button id="Cright" class="dodocontrolButton">Right</button></div>
                        <div class="down"><button id="Cdown" class="dodocontrolButton">Down</button></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="LevelEditor">
        <div id="LevelEditorContent" style="opacity: 100%;position:absolute;top:0;left:10vw;width:15vw;border:rgb(59, 59, 59) 1px solid;background-color: rgb(39, 39, 39);border-radius: 0 0 5px 5px;-index:-1">
            <button id="toggleLevelEditor" class="modbutton">LevelEditor (click)</button>
            <div class="LevelEditorOption">
                <button id="toggleLevelEditorObjects" class="modbutton">LevelEditor Objects</button>
                <div class="LevelEditorObjects" style="max-height:25vh;overflow-y: auto;">
                    <button class="button" id="GetAllObjects">get All Objects (emergency)</button>
                    <button class="button" id="DeleteAllMadeObjects">Delete All (made) Objects</button>
                    <button class="button" id="DeleteSelectedMadeObjects">Delete Selected Object</button>
                    <br>
                    <select id="ObjectSelector"><option> </option></select>
                </div>
                <button id="toggleLevelEditorAdd" class="modbutton">LevelEditor Add</button>
                <div class="LevelEditorAdd">
                    <button id="addBox" class="button">add box</button><br>
                    <button id="addcylinder" class="button">add cylinder</button>
                </div>
                <button id="toggleLevelEditorControl" class="modbutton">LevelEditor Control</button>
                <div class="LevelEditorControl">
                    <p>Position</p>
                    <input type="text" id="x"><input type="text" id="y"><input type="text" id="z">
                    <p>Rotation</p>
                    <input type="text" id="xr"><input type="text" id="yr"><input type="text" id="zr">
                    <p>Scale</p>
                    <input type="text" id="xs"><input type="text" id="ys"><input type="text" id="zs">
                    <br>
                    <button class="button" id="ControlButton">Set</button>
                    <br>
                    <button class="button" id="Export">Export Level</button>
                    <textarea style="color:black;font-size: xx-small;font-family: arial;" id="ExportMap"></textarea>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $(document).ready(function () {
            $(".modmenuOption").hide();
            $(".LevelEditorOption").hide();
            $(".LevelEditorObjects").hide();
            $(".LevelEditorControl").hide();
            $(".LevelEditorAdd").hide();
            $("#cheats").hide();
            $("#gravitytoggle").hide();
            $("#speedtoggle").hide();
            $("#dodocontrols").hide();

            $("#testbutton").click(function() {
                sphere = BABYLON.MeshBuilder.CreateIcoSphere("icosphere", options = {radius: 3, subdivisions: 4}, scene);
                sphere.position = new BABYLON.Vector3(0, 2, -50);
                // player.scale = new BABYLON.Vector3(0.1, 0.1, 0.1);
                player.scaling = new BABYLON.Vector3(2, 2, 2);
                physicsImpostor = new BABYLON.PhysicsImpostor(sphere, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 1, restitution: 1, friction: 0.1}, scene)
            })

            let lasthighlight;
            $("#ObjectSelector").on("input", function() {
                console.log($(this).val(), lasthighlight)
                try{meshes[lasthighlight].showBoundingBox = false;}catch{}
                lasthighlight = $(this).val();
                meshes[$(this).val()].showBoundingBox = true;
            });

            let meshes;
            // gotta add unselector
            function GetAllObjects() {
                meshes = null;
                document.getElementById("ObjectSelector").innerHTML = "<option> </option>";
                meshes = scene.getMeshesByTags("mesh")
                console.log(meshes.length)
                for(let i = 0;i < meshes.length;i++) {
                    document.getElementById("ObjectSelector").innerHTML += "<option value="+i+">"+meshes[i].name+"</option>"
                }
            }
            $("#GetAllObjects").click(function() {
                GetAllObjects();
            })
            $("#DeleteAllMadeObjects").click(function(){
                for(let i = 0;i < boxnum;i++) {
                    scene.getMeshByName("box"+i).dispose()
                }
                for(let i = 0;i < cylindernum;i++) {
                    scene.getMeshByName("box"+i).dispose()
                }
                boxnum = 0;
                cylindernum = 0;
                GetAllObjects()
            })
            $("#DeleteSelectedMadeObjects").click(function(){
                meshes[$("#ObjectSelector").val()].dispose();
                GetAllObjects()
            })
            let boxnum = 0
            let cylindernum = 0
            $("#addBox").click(function() {
                // texture
                let mat = new BABYLON.StandardMaterial("mat", scene);
                mat.diffuseTexture = new BABYLON.Texture("assets/textures/bright.png", scene);
                mat.diffuseTexture.uScale = mat.diffuseTexture.vScale = 1.0;
                mat.backFaceCulling = false;
                mat.freeze();

                let box = BABYLON.MeshBuilder.CreateBox("box"+boxnum, options={size:2}, scene);
                box.checkCollisions = true;
                box.applyGravity = false;
                box.isPickable = false;
                scene.collisionsEnabled = true;
                camera.checkCollisions = true;
                BABYLON.Tags.AddTagsTo(box, "mesh");
                box.physicsImpostor = new BABYLON.PhysicsImpostor(box, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0, friction: 0.6}, scene)
                box.material = mat;
                
                boxnum++
                GetAllObjects()
            })
            $("#addcylinder").click(function() {
                // texture
                let mat = new BABYLON.StandardMaterial("mat", scene);
                mat.diffuseTexture = new BABYLON.Texture("assets/textures/bright.png", scene);
                mat.diffuseTexture.uScale = mat.diffuseTexture.vScale = 1.0;
                mat.backFaceCulling = false;
                mat.freeze();

                let cylinder = BABYLON.MeshBuilder.CreateCylinder("cylinder"+cylindernum, options={height:2}, scene);
                cylinder.checkCollisions = true;
                cylinder.applyGravity = false;
                cylinder.isPickable = false;
                scene.collisionsEnabled = true;
                camera.checkCollisions = true;
                BABYLON.Tags.AddTagsTo(cylinder, "mesh");
                cylinder.physicsImpostor = new BABYLON.PhysicsImpostor(cylinder, BABYLON.PhysicsImpostor.CylinderImpostor, { mass: 0, restitution: 0, friction: 0.6}, scene)
                cylinder.material = mat;
                
                cylindernum++
                GetAllObjects()
            })
            function Transform(x=0,y=0,z=0,xr=0,yr=0,zr=0,xs=1,ys=1,zs=1) {
                console.log(x, y, z)
                try{meshes[$("#ObjectSelector").val()].position = new BABYLON.Vector3(x,y,z)} catch{}
                try{meshes[$("#ObjectSelector").val()].rotation = new BABYLON.Vector3(xr,yr,zr)} catch{}
                try{meshes[$("#ObjectSelector").val()].scaling = new BABYLON.Vector3(xs,ys,zs)} catch{}
            }
            $("#ControlButton").click(function() {
                Transform(
                    $("#x").val() !== "" ? $("#x").val() : undefined,$("#y").val() !== "" ? $("#y").val() : undefined,$("#z").val() !== "" ? $("#z").val() : undefined,
                    $("#xr").val() !== "" ? $("#xr").val() : undefined,$("#yr").val() !== "" ? $("#yr").val() : undefined,$("#zr").val() !== "" ? $("#zr").val() : undefined,
                    $("#xs").val() !== "" ? $("#xs").val() : undefined,$("#ys").val() !== "" ? $("#ys").val() : undefined,$("#zs").val() !== "" ? $("#zs").val() : undefined)
            })
            const MapScript1 = 'var map = {title: "EngineV9Level",song: "env2",maker: "Someone",spawn: [0, 0.5, 0],init: function() {let box;' // don't forget to close brackets with , + stick a loop that adds collition
            const MapScirpt2 = 'post: function() {},section_id: 0,section_update: function() {},reset: function() {' // don't forget to close brackets with ,
            const MapScirpt3 = 'player_move: function() {},physics_update: function() {},render_update: function() {},}'
            let MapInit = [];
            function ExportMap() {
                GetAllObjects();
                console.log(meshes[0].getBoundingInfo().boundingBox)
                for(let i = 0;i < meshes.length;i++) {
                    let boundingBox = meshes[i].getBoundingInfo().boundingBox;
                    let minCorner = boundingBox.minimumWorld;
                    let maxCorner = boundingBox.maximumWorld;
                    let width = Math.abs(maxCorner.x-minCorner.x)/2
                    let height = Math.abs(maxCorner.y-minCorner.x)/2
                    let depth = Math.abs(maxCorner.z-minCorner.z)/2
                    console.log(width, height*2+.25, depth)
                            // a.p([0, -1.0, 0], [0, 0, 0], [2.5, 1.0, 2.5], 0, 0);
                            // a.re('P0', [0, -1.0, 0], [0, 0, 0], [2.5, 1.0, 2.5]);
                    MapInit.push("box = BABYLON.MeshBuilder.CreateBox('"+meshes[i].name+"', options={size:1}, scene);box.scaling = new BABYLON.Vector3("+width*2+","+(height*2+.25)+","+depth*2+");box.position = new BABYLON.Vector3("+(maxCorner.x-width)+","+(maxCorner.y-height-.125)+","+(maxCorner.z-depth)+");box.rotation = new BABYLON.Vector3("+meshes[i].rotation.x+","+meshes[i].rotation.y+","+meshes[i].rotation.z+");BABYLON.Tags.AddTagsTo(box, 'mesh');")
                    eval(MapInit[i])
                }
                console.log(MapInit)
            }
            $("#Export").click(function(){
                $("#ExportMap").val(ExportMap());
            })

            $('#gravity').val('-9');
            $('#speed').val('0.28');
            $("#speedindicator").text($("#speed").val());
            $("#gravityindicator").text($("#gravity").val());

            $("#togglemenu").click(function () {
                $(".modmenuOption").toggle();
            });
            $("#toggleLevelEditor").click(function () {
                $(".LevelEditorOption").toggle();
            });
            $("#toggleLevelEditorObjects").click(function () {
                $(".LevelEditorObjects").toggle();
            });
            $("#toggleLevelEditorControl").click(function () {
                $(".LevelEditorControl").toggle();
            });
            $("#toggleLevelEditorAdd").click(function () {
                $(".LevelEditorAdd").toggle();
            });
            $("#toggledodocontrols").click(function () {
                $("#dodocontrols").toggle();
            });
            $("#togglecheats").click(function () {
                $("#cheats").toggle();
            });
            $("#gravityoverwrite").click(function () {
                $("#gravitytoggle").toggle();
            });
            $("#speedoverwrite").click(function () {
                $("#speedtoggle").toggle();
            });

            $("#gravity").on("input", function() {
                $("#gravityindicator").text($(this).val());
            });
            $("#speed").on("input", function() {
                $("#speedindicator").text($(this).val());
            });

            $("#home").click(function () {
                camera.position = new BABYLON.Vector3(0,0,0);
            });
            $("#up").click(function () {
                camera.position.y += 1;
            });
            $("#left").click(function () {
                camera.position.x += 1;
            });
            $("#right").click(function () {
                camera.position.x -= 1;
            });
            $("#down").click(function () {
                camera.position.y -= 1;
            });
            $("#foreward").click(function () {
                camera.position.z -= 1;
            });
            $("#backward").click(function () {
                camera.position.z += 1;
            });

            // rotation
            $("#Chome").click(function () {
                camera.rotation = new BABYLON.Vector3(0,0,0);
            });
            $("#Cup").click(function () {
                camera.rotation.x -= .25;
            });
            $("#Cleft").click(function () {
                camera.rotation.y -= .25;
            });
            $("#Cright").click(function () {
                camera.rotation.y += .25;
            });
            $("#Cdown").click(function () {
                camera.rotation.x += .25;
            });
            
            $(document).keypress(function(event) {
                // move
                if (event.key === "j") {
                    camera.position.x += 1;
                }
                if (event.key === "l") {
                    camera.position.x -= 1;
                }
                if (event.key === "k") {
                    camera.position.z += 1;
                }
                if (event.key === "i") {
                    camera.position.z -= 1;
                }
                if (event.key === "p") {
                    camera.position.y += 1;
                }
                if (event.key === ";") {
                    camera.position.y -= 1;
                }
                // rotation
                if (event.key === "J") {
                    camera.rotation.y -= .25;
                }
                if (event.key === "L") {
                    camera.rotation.y += .25;
                }
                if (event.key === "K") {
                    camera.rotation.x += .25;
                }
                if (event.key === "I") {
                    camera.rotation.x -= .25;
                }
            });
        });
    </script>

    <script type="text/javascript" src="/libraries/babylon.js"></script>
    <script type="text/javascript" src="/scripts/fov.js?v=0.179"></script>
    <script type="text/javascript" src="/scripts/change_state.js?v=0.179"></script>
    <script type="text/javascript" src="/scripts/decorations.js?v=0.179"></script>
    <script type="text/javascript" src="/scripts/maker.js?v=0.179"></script>
    <script type="text/javascript" src="/scripts/alias.js?v=0.179"></script>
    <script type="text/javascript" src="/scripts/const_controller.js?v=0.179"></script>
    <script type="text/javascript" src="/scripts/cleanup.js?v=0.179"></script>
    <script type="text/javascript" src="/scripts/start.js?v=0.179"></script>
    <script type="text/javascript" src="/scripts/update.js?v=0.179"></script>
    <script type="text/javascript" src="/scripts/flyjump.js?v=0.179"></script>
    <script type="text/javascript" src="/scripts/boot.js?v=0.179"></script>
</body>
</html>